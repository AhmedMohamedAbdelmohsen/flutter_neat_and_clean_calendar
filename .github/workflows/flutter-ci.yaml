name: CI  

# See https://github.com/google/flutter-desktop-embedding/blob/master/.github/workflows/ci.yml

on: [push, pull_request]

jobs:
  build:  
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        # os: [macOS-10.15, ubuntu-18.04, windows-2019]
        os: [macOS-10.15, ubuntu-18.04]
        include: 
        - os: ubuntu-18.04
          TARGET: apk
        - os: macOS-10.15
          TARGET: ios  
      # Disable fail-fast; we want results from all OSes even if one fails.
      fail-fast: false

    steps:

    - uses: actions/checkout@v2
    - uses: subosito/flutter-action@v1
      with:
        channel: stable

    - name: Install Linux dependencies
      if: startsWith(matrix.os, 'ubuntu')
      run: |
        sudo apt-get update
        sudo apt-get install -y libgtk-3-dev libx11-dev pkg-config cmake ninja-build libblkid-dev liblzma-dev

    - name: Doctor
      run: flutter doctor -v

    - name: Analyze
      run: flutter analyze .      

#    - name: Run Tests
#      run: flutter test
    
    - name: Build testbed debug
      run: |	
        flutter packages get
        flutter build -v ${{matrix.TARGET}} --debug	

    - name: Build testbed release
      run: |	
        flutter packages get	
        flutter build -v ${{matrix.TARGET}} --release	